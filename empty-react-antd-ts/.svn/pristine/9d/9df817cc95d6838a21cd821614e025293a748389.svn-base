import './Container.css';

import React from 'react';
import {withRouter, RouteComponentProps} from 'react-router-dom';
import { Layout, Menu, Button, Avatar, Dropdown, Icon,message, notification, Spin, ConfigProvider } from 'antd';
import zhCN from 'antd/es/locale/zh_CN';
import ImageViewer from './ImageViewer';
import moment from 'moment';
import 'moment/locale/zh-cn';
moment.locale('zh-cn');

/**
 * 公共组件：顶部栏，包括logo、菜单和登录状态判断；
 */
class ContainerWithHeader extends React.Component<RouteComponentProps>{
    readonly state:{
    }={
        
    }

    /**
     * 顶部退出登录处理：请求服务后，清除本地缓存，跳转到登录页
     */
    logout=()=>{
        this.props.history.replace("/");
    };

    /**
     * 通用布局容器
     */
    render(){
        const {Header,Content,Footer}=Layout;
        const selectedKey="switch";
        const isLogin=false;
        const menu=(
            <Menu>
                <Menu.Item onClick={this.logout}>
                    <Icon type="logout"/> 退出
                </Menu.Item>
            </Menu>
        );

        return (
            <ConfigProvider locale={zhCN}>
                <Layout className="layout">
                    <Header>
                        <div className="header-container">
                            <div className="header-logo">{process.env.REACT_APP_NAME}</div>
                            {isLogin?(
                                    <Dropdown overlay={menu} placement="bottomLeft">
                                        <Button className="header-login-button" type="link">
                                            <Avatar icon="user"/> 机构名称
                                        </Button>
                                    </Dropdown>
                                ):(
                                    <Button style={{display:"none"}}
                                        className="header-login-button"
                                        type="link" onClick={this.logout}>
                                        <Avatar icon="user"/> 机构登录
                                    </Button>
                                )
                            }
                            {isLogin?(
                                <Menu theme="dark" mode="horizontal" 
                                    defaultSelectedKeys={[selectedKey]}
                                    style={{lineHeight:'64px'}}
                                    >
                                    <Menu.Item key="switch">信息维护</Menu.Item>
                                </Menu>
                            ):(
                                <Menu theme="dark" mode="horizontal" 
                                    defaultSelectedKeys={[selectedKey]}
                                    style={{lineHeight:'64px'}}
                                    >
                                <Menu.Item key="switch">执业申请</Menu.Item>
                            </Menu>
                            )
                            }
                        </div>
                    </Header>
                    <Content className="content-container">
                        {this.props.children}
                    </Content>
                    <Footer className="footer-container" style={{textAlign:"center"}}>
                        {`copyright@成都金控数据服务有限公司.System Version：${process.env.REACT_APP_VERSION}`}
                    </Footer>

                    {/* 图片查看器 */}
                    <ImageViewer />
                </Layout>
            </ConfigProvider>
        );
    }

    /**
     * 载入全部后，设置消息提示样式
     */
    componentDidMount(){
        message.config({
            maxCount:3
        });
        notification.config({
            placement:"bottomRight",
            duration:0
        });
    }
}
const Container=withRouter(ContainerWithHeader);
export default Container;

/**
 * 载入中
 */
export class ContainerLoading extends React.Component{
    render(){
        return (
            <Container>
                <Spin className="page-loading" size="large" tip="正在载入……"></Spin>
            </Container>
        )
    }
}