{"ast":null,"code":"import { string } from \"prop-types\";\n/**\n * 数据缓存器：单例模式\n */\n\nexport class DataCache {\n  constructor() {\n    this._tokenExpired = 2 * 24 * 60;\n    this._editExpired = 15 * 24 * 60;\n    this._dictionaryExpired = 60 * 24 * 60;\n    this._dataMap = new Map();\n  }\n\n  DataCache() {} // Token默认缓存时间(单位：分钟)\n\n\n  /**\n   * 写入或返回本地储存的Token\n   * @param t token内容\n   */\n  token(t, data) {\n    if (t && data) {\n      this.put(\"token\", t, this._tokenExpired);\n      this.put(\"token_data\", data, this._tokenExpired);\n      return {\n        token: t,\n        data: data\n      };\n    }\n\n    return {\n      token: this.get(\"token\"),\n      data: this.get(\"token_data\")\n    };\n  }\n  /**\n   * 写入或返回当前用户信息\n   * @param data 编辑记录内容\n   */\n\n\n  user(data) {\n    if (data) {\n      this.put(\"login_user\", JSON.stringify(data), this._editExpired);\n      return data;\n    }\n\n    const value = this.get(\"login_user\");\n    return value ? JSON.parse(value) : value;\n  }\n  /**\n   * 写入或返回当前编辑情况的记录，如备案申请的信息（单号，第一步等）\n   * @param data 编辑记录内容\n   */\n\n\n  edit(data) {\n    if (data) {\n      this.put(\"edit\", JSON.stringify(data), this._editExpired);\n      return data;\n    }\n\n    const value = this.get(\"edit\");\n    return value ? JSON.parse(value) : value;\n  }\n  /**\n   * 用于不同路由之间的数据传递（仅记录在内存中）\n   * @param data 数据内容\n   */\n\n\n  transfer(data) {\n    if (data) {\n      this._dataMap.set(\"transferData\", data);\n    }\n\n    return this._dataMap.get(\"transferData\");\n  }\n  /**\n   * 获取或插入数据字典信息\n   * @param keyOrData 子项键名或插入数据对象\n   */\n\n\n  dictionary(keyOrData) {\n    //写入模式\n    if (keyOrData && !(keyOrData instanceof string)) {\n      this.put(\"dictionary\", JSON.stringify(keyOrData), this._dictionaryExpired);\n      return keyOrData;\n    }\n\n    const value = this.get(\"dictionary\");\n    const data = value ? JSON.parse(value) : null; //全部返回模式\n\n    if (!data) return data; //子项返回模式\n\n    return data[keyOrData];\n  }\n  /**\n   * 本地存储写入\n   * @param key \n   * @param value \n   * @param expired 过期时间（单位为分钟）\n   */\n\n\n  put(key, value, expired) {\n    if (!window.localStorage) return;\n    localStorage.setItem(key, value);\n\n    if (expired) {\n      localStorage.setItem(key + \"_expired\", String(Date.now() + expired * 60 * 1000));\n    }\n  } //本地存储读取\n\n\n  get(key) {\n    if (!window.localStorage) return null; // 检查过期后删除\n\n    const now = Date.now();\n    const expired = localStorage.getItem(key + \"_expired\") || now + 1;\n\n    if (now >= expired) {\n      localStorage.removeItem(key);\n      return null;\n    }\n\n    return localStorage.getItem(key);\n  }\n\n}\nDataCache.Instance = new DataCache();","map":{"version":3,"sources":["/Users/maqiang/编程/yzwj-recorder-web/src/app/DataCache.ts"],"names":["string","DataCache","_tokenExpired","_editExpired","_dictionaryExpired","_dataMap","Map","token","t","data","put","get","user","JSON","stringify","value","parse","edit","transfer","set","dictionary","keyOrData","key","expired","window","localStorage","setItem","String","Date","now","getItem","removeItem","Instance"],"mappings":"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","sourcesContent":["import { string } from \"prop-types\";\n\n/**\n * 数据缓存器：单例模式\n */\nexport class DataCache{\n    public static readonly Instance:DataCache=new DataCache();\n    private DataCache(){}\n\n    // Token默认缓存时间(单位：分钟)\n    private _tokenExpired:number=2*24*60;\n    // 工单编辑默认缓存时间(单位：分钟)\n    private _editExpired:number=15*24*60;\n    // 字典数据默认缓存时间(单位：分钟)\n    private _dictionaryExpired:number=60*24*60;\n\n    //记录传递的数据信息\n    private _dataMap:Map<string,any>=new Map();\n\n    /**\n     * 写入或返回本地储存的Token\n     * @param t token内容\n     */\n    token(t?:string,data?:any):{token:string|null,data?:any}{\n        if(t&&data){\n            this.put(\"token\",t,this._tokenExpired);\n            this.put(\"token_data\",data,this._tokenExpired);\n            return {token:t,data:data};\n        }\n        return {token:this.get(\"token\"),data:this.get(\"token_data\")};\n    }\n\n    /**\n     * 写入或返回当前用户信息\n     * @param data 编辑记录内容\n     */\n    user(data?:any){\n        if(data){\n            this.put(\"login_user\",JSON.stringify(data),this._editExpired);\n            return data;\n        }\n        \n        const value=this.get(\"login_user\");\n        return value?JSON.parse(value):value;\n    }\n\n    /**\n     * 写入或返回当前编辑情况的记录，如备案申请的信息（单号，第一步等）\n     * @param data 编辑记录内容\n     */\n    edit(data?:any){\n        if(data){\n            this.put(\"edit\",JSON.stringify(data),this._editExpired);\n            return data;\n        }\n        \n        const value=this.get(\"edit\");\n        return value?JSON.parse(value):value;\n    }\n\n    /**\n     * 用于不同路由之间的数据传递（仅记录在内存中）\n     * @param data 数据内容\n     */\n    transfer(data?:any){\n        if(data){\n            this._dataMap.set(\"transferData\",data);\n        }\n        return this._dataMap.get(\"transferData\");\n    }\n\n    /**\n     * 获取或插入数据字典信息\n     * @param keyOrData 子项键名或插入数据对象\n     */\n    dictionary(keyOrData?:string|any){\n        //写入模式\n        if(keyOrData&&!(keyOrData instanceof string)){\n            this.put(\"dictionary\",JSON.stringify(keyOrData),this._dictionaryExpired);\n            return keyOrData;\n        }\n\n        const value=this.get(\"dictionary\");\n        const data=value?JSON.parse(value):null;\n\n        //全部返回模式\n        if(!data) return data;\n        //子项返回模式\n        return data[keyOrData];\n    }\n\n    /**\n     * 本地存储写入\n     * @param key \n     * @param value \n     * @param expired 过期时间（单位为分钟）\n     */\n    private put(key:string,value:string,expired:number):void{\n        if(!window.localStorage) return;\n\n        localStorage.setItem(key,value);\n        if(expired){\n            localStorage.setItem(key+\"_expired\",String(Date.now()+expired*60*1000));\n        }\n    }\n\n    //本地存储读取\n    private get(key:string){\n        if(!window.localStorage) return null;\n\n        // 检查过期后删除\n        const now=Date.now();\n        const expired=localStorage.getItem(key+\"_expired\")||now+1;\n        if(now>=expired){\n            localStorage.removeItem(key);\n            return null;\n        }\n        \n        return localStorage.getItem(key);\n    }\n}"]},"metadata":{},"sourceType":"module"}