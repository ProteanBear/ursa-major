{"ast":null,"code":"import { createHashHistory } from 'history';\n/**请求方式 */\n\nvar Method;\n/**数据格式类型 */\n\n(function (Method) {\n  Method[\"GET\"] = \"GET\";\n  Method[\"HEAD\"] = \"HEAD\";\n  Method[\"POST\"] = \"POST\";\n  Method[\"PUT\"] = \"PUT\";\n  Method[\"PATCH\"] = \"PATCH\";\n  Method[\"DELETE\"] = \"DELETE\";\n})(Method || (Method = {}));\n\nvar ContentType;\n/**\n * 服务器返回的内容\n */\n\n(function (ContentType) {\n  ContentType[\"JSON\"] = \"application/json;charset=UTF-8\";\n  ContentType[\"Form\"] = \"application/x-www-form-urlencoded; charset=UTF-8\";\n  ContentType[\"Multipart\"] = \"multipart/form-data; charset=utf-8; boundary=__X_YZWJ_BOUNDARY__\";\n  ContentType[\"File\"] = \"application/octet-stream\";\n})(ContentType || (ContentType = {}));\n\n/**\n * Http请求\n */\nexport class HttpRequest {\n  /**\n   * 发送GET请求\n   * @param url 链接地址\n   * @param parameters 传递参数\n   */\n  async get(url, parameters) {\n    url = this.fullUrl(url);\n    const option = this.defualtOption(url);\n    option.method = Http.Method.GET;\n    return await fetch(url, option).then(this.transform).then(this.responseData).catch(this.errorResponse);\n  }\n  /**\n   * 发送POST请求\n   * @param url 链接地址\n   * @param data 传递数据\n   */\n\n\n  async post(url, data) {\n    url = this.fullUrl(url);\n    const option = this.defualtOption(url);\n    option.method = Http.Method.POST;\n    option.headers = new Headers({\n      \"Content-Type\": Http.ContentType.JSON\n    });\n    option.body = JSON.stringify(data);\n    return await fetch(url, option).then(this.transform).then(this.responseData).catch(this.errorResponse);\n  }\n  /**\n   * 上传文件或图片处理\n   * @param url 链接地址\n   * @param data 传递数据\n   */\n\n\n  upload(url, data) {\n    throw new Error(\"Method not implemented.\");\n  }\n  /**\n   * 生成请求的Option设置\n   * @param url 链接地址,判断是否HTTPS\n   */\n\n\n  defualtOption(url) {\n    return {\n      cache: \"no-cache\",\n      credentials: url.startsWith(\"https:\") ? \"include\" : \"omit\",\n      mode: \"cors\",\n      redirect: \"follow\",\n      referrerPolicy: \"no-referrer\"\n    };\n  }\n  /**\n   * 获取完整的链接地址（不以http开头，使用全局服务地址补全）\n   * @param url 链接地址\n   */\n\n\n  fullUrl(url) {\n    return !url || url.startsWith(\"http:\") || url.startsWith(\"https:\") ? url : process.env.REACT_APP_SERVER_DOMAIN + url;\n  }\n  /**\n   * 判断网络状态码，进行错误跳转\n   * @param response 请求返回内容\n   */\n\n\n  transform(response) {\n    //网络状态错误\n    if (!response.ok) {\n      const history = createHashHistory();\n\n      switch (response.status) {\n        case 404:\n          history.push(\"/error404\");\n          break;\n\n        case 403:\n          history.push(\"/error403\");\n          break;\n\n        case 500:\n        default:\n          history.push(\"/error500\");\n      }\n\n      throw new Error(\"\\u51FA\\u73B0\\u7F51\\u7EDC\\u9519\\u8BEF\\uFF01\\u72B6\\u6001\\u7801:\".concat(response.status, \",\\u9519\\u8BEF\\u5185\\u5BB9\\uFF1A\").concat(response.statusText, \".\"));\n    }\n\n    return response.json();\n  }\n  /**\n   * 解析服务端返回的Json内容，并生成Web端通用的处理对象\n   * @param response \n   */\n\n\n  responseData(response) {\n    const result = {\n      success: response.code === 0,\n      data: response.data,\n      message: response.msg\n    };\n    return new Promise((resolve, reject) => {\n      resolve(result);\n    });\n  }\n  /**\n   * 返回错误信息\n   * @param error 错误\n   */\n\n\n  errorResponse(error) {\n    const result = {\n      success: false,\n      message: error.message\n    };\n    return new Promise((resolve, reject) => {\n      reject(result);\n    });\n  }\n\n}","map":{"version":3,"sources":["/Users/maqiang/编程/yzwj-recorder-web/src/utils/Request.ts"],"names":["createHashHistory","Method","ContentType","HttpRequest","get","url","parameters","fullUrl","option","defualtOption","method","Http","GET","fetch","then","transform","responseData","catch","errorResponse","post","data","POST","headers","Headers","JSON","body","stringify","upload","Error","cache","credentials","startsWith","mode","redirect","referrerPolicy","process","env","REACT_APP_SERVER_DOMAIN","response","ok","history","status","push","statusText","json","result","success","code","message","msg","Promise","resolve","reject","error"],"mappings":"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","sourcesContent":["import {createHashHistory} from 'history';\n\n/**请求方式 */\nenum Method{\n    GET=\"GET\",HEAD=\"HEAD\",\n    POST=\"POST\",PUT=\"PUT\",PATCH=\"PATCH\",\n    DELETE=\"DELETE\"\n}\n\n/**数据格式类型 */\nenum ContentType{\n    JSON=\"application/json;charset=UTF-8\",\n    Form=\"application/x-www-form-urlencoded; charset=UTF-8\",\n    Multipart=\"multipart/form-data; charset=utf-8; boundary=__X_YZWJ_BOUNDARY__\",\n    File=\"application/octet-stream\"\n}\n\n/**\n * 服务器返回的内容\n */\ninterface ServerResponse<R>{\n    code:number,\n    data?:R,\n    msg:string\n}\n\n/**\n * 定义接口返回类型\n */\nexport interface HttpResponse<R>{\n    success:boolean,\n    data?:R,\n    message?:string\n}\n\n/**\n * Http请求\n */\nexport class HttpRequest{\n    /**\n     * 发送GET请求\n     * @param url 链接地址\n     * @param parameters 传递参数\n     */\n    async get<R, P = {}>(url: string, parameters?: P | undefined): Promise<HttpResponse<R>> {\n        url=this.fullUrl(url);\n        const option:RequestInit=this.defualtOption(url);\n\n        option.method=Http.Method.GET;\n        return await fetch(url,option)\n                .then<ServerResponse<R>>(this.transform)\n                .then<HttpResponse<R>>(this.responseData)\n                .catch<HttpResponse<R>>(this.errorResponse);\n    } \n    \n    /**\n     * 发送POST请求\n     * @param url 链接地址\n     * @param data 传递数据\n     */\n    async post<R, P = {}>(url: string, data?: P | undefined): Promise<HttpResponse<R>> {\n        url=this.fullUrl(url);\n        const option:RequestInit=this.defualtOption(url);\n\n        option.method=Http.Method.POST;\n        option.headers=new Headers({\n            \"Content-Type\":Http.ContentType.JSON\n        });\n        option.body=JSON.stringify(data);\n        return await fetch(url,option)\n                .then<ServerResponse<R>>(this.transform)\n                .then<HttpResponse<R>>(this.responseData)\n                .catch<HttpResponse<R>>(this.errorResponse);\n    }\n\n    /**\n     * 上传文件或图片处理\n     * @param url 链接地址\n     * @param data 传递数据\n     */\n    upload<R, P = {}>(url: string, data?: P | undefined): Promise<R> {\n        throw new Error(\"Method not implemented.\");\n    }\n\n    /**\n     * 生成请求的Option设置\n     * @param url 链接地址,判断是否HTTPS\n     */\n    private defualtOption(url:string):RequestInit{\n        return {\n            cache:\"no-cache\",\n            credentials:(url.startsWith(\"https:\")?\"include\":\"omit\"),\n            mode:\"cors\",\n            redirect: \"follow\",\n            referrerPolicy: \"no-referrer\"\n        };\n    }\n\n    /**\n     * 获取完整的链接地址（不以http开头，使用全局服务地址补全）\n     * @param url 链接地址\n     */\n    private fullUrl(url:string){\n        return (!url\n                ||url.startsWith(\"http:\")\n                ||url.startsWith(\"https:\"))\n                    ?url\n                    :(process.env.REACT_APP_SERVER_DOMAIN+url);\n    }\n\n    /**\n     * 判断网络状态码，进行错误跳转\n     * @param response 请求返回内容\n     */\n    private transform<R>(response:Response):Promise<ServerResponse<R>>{\n        //网络状态错误\n        if(!response.ok){\n            const history = createHashHistory();\n            switch(response.status){\n                case 404:\n                    history.push(\"/error404\");\n                    break;\n                case 403:\n                    history.push(\"/error403\");\n                    break;\n                case 500:\n                default:\n                    history.push(\"/error500\");\n            }\n            throw new Error(`出现网络错误！状态码:${response.status},错误内容：${response.statusText}.`);\n        }\n        return response.json();\n    }\n\n    /**\n     * 解析服务端返回的Json内容，并生成Web端通用的处理对象\n     * @param response \n     */\n    private responseData<R>(response:ServerResponse<R>):Promise<HttpResponse<R>>{\n        const result:HttpResponse<R>={\n            success:response.code===0,\n            data:response.data,\n            message:response.msg\n        };\n        return new Promise((resolve, reject)=>{\n            resolve(result);\n        });\n    }\n\n    /**\n     * 返回错误信息\n     * @param error 错误\n     */\n    private errorResponse<R>(error:Error):Promise<HttpResponse<R>>{\n        const result:HttpResponse<R>={\n            success:false,\n            message:error.message\n        };\n        return new Promise((resolve, reject)=>{\n            reject(result);\n        });\n    }\n}"]},"metadata":{},"sourceType":"module"}