import React from 'react';
import { ApplyContentManager } from '../app/Model';
import { Skeleton, Layout, Row, Col, Descriptions, Typography, Carousel, Tag } from 'antd';
import ImageViewer from './ImageViewer';
import { DictionaryLoader } from '../app/DictionaryLoader';
import ApplyUtils from '../utils/ApplyUtils';

type OrganizationDetailInforManagerProps={
    /**法人信息 */
    legal?:ApplyContentManager;
    /**负责人信息 */
    princpal?:ApplyContentManager;
    /**联系人信息 */
    contact?:ApplyContentManager;
}

/**
 * 申请详情中的申请资料中的管理人员信息
 */
export default class OrganizationDetailInforManager extends React.Component<OrganizationDetailInforManagerProps>{
    readonly state:{}={}

    /**
     * 页面布局
     */
    render(){
        if(!this.props.legal
            ||!this.props.princpal
            ||!this.props.contact){
            return (
                <Skeleton active /> 
            );
        }

        const {Content}=Layout;
        const {Paragraph,Title,Text}=Typography;
        const {legal,princpal,contact}=this.props;
        const dictionary=DictionaryLoader.instance;
        let legalImageIndex=0,princpalImageIndex=0;

        return (
            <Content>
                {/* 法人 */}
                <div id="apply-detail-legal">
                    <Row>
                        <Col span={11}>
                            <Descriptions title={
                                    <Title level={4}>
                                        <Text strong>{legal.name}</Text>
                                        <Tag color="geekblue" style={{marginLeft:5}}>法人</Tag>
                                    </Title>
                                }
                                layout="vertical"
                                column={4} bordered={true} size="small">
                                <Descriptions.Item label="性别">{legal.sex}</Descriptions.Item>
                                <Descriptions.Item label="身份证号" span={3}>{legal.idcard}</Descriptions.Item>
                                <Descriptions.Item label="出生年月">{ApplyUtils.displayDate(legal.birthday)}</Descriptions.Item>
                                <Descriptions.Item label="毕业专业" span={2}>{legal.specialty}</Descriptions.Item>
                                <Descriptions.Item label="学历">{dictionary.educationLabel(legal.education)}</Descriptions.Item>
                            </Descriptions>
                        </Col>
                        <Col span={6} offset={1} className="descriptions-carousel">
                            <Paragraph>
                                <Title level={4}>&nbsp;</Title>
                            </Paragraph>
                            <Carousel>
                            {
                                legal.idcardImg.split(",").map((src)=>(
                                    <img data-image-index={legalImageIndex++} 
                                        onClick={event=>{this.onPreviewImages(event,"#apply-detail-legal")}}
                                        src={src} className="image-to-view"
                                        alt={`法人姓名：${legal.name}；身份证号码：${legal.idcard}`}
                                    />
                                ))
                            }
                            </Carousel>
                        </Col>
                        <Col span={6} className="descriptions-carousel">
                            <Paragraph>
                                <Title level={4}>&nbsp;</Title>
                            </Paragraph>
                            <Carousel>
                            {
                                legal.signature.split(",").map((src)=>(
                                    <img 
                                        data-image-index={legalImageIndex++} 
                                        onClick={event=>{this.onPreviewImages(event,"#apply-detail-legal")}}
                                        src={src} className="image-to-view"
                                        alt={`法人姓名：${legal.name}`}
                                    />
                                ))
                            }
                            </Carousel>
                        </Col>
                    </Row>
                    <Row>
                        <Col span={24}>
                            <Descriptions layout="vertical" bordered={true} size="small">
                                <Descriptions.Item label="工作履历">
                                {
                                    legal.personalResumes.map(resume=>(
                                        <span>{`${resume.time}：工作于【${resume.unit}】，职务为${resume.position}。`}<br/></span>
                                    ))
                                }
                                </Descriptions.Item>
                            </Descriptions>
                        </Col>
                    </Row>
                </div>

                {/* 负责人 */}
                <div id="apply-detail-princpal">
                    <Row style={{marginTop:35}}>
                        <Col span={11}>
                            <Descriptions title={
                                    <Title level={4}>
                                        <Text strong>{princpal.name}</Text>
                                        <Tag color="geekblue" style={{marginLeft:5}}>负责人</Tag>
                                    </Title>
                                }
                                layout="vertical"
                                column={4} bordered={true} size="small">
                                <Descriptions.Item label="性别">{princpal.sex}</Descriptions.Item>
                                <Descriptions.Item label="身份证号" span={3}>{princpal.idcard}</Descriptions.Item>
                                <Descriptions.Item label="出生年月">{princpal.birthday}</Descriptions.Item>
                                <Descriptions.Item label="毕业专业" span={2}>{princpal.specialty}</Descriptions.Item>
                                <Descriptions.Item label="学历">{dictionary.educationLabel(princpal.education)}</Descriptions.Item>
                                <Descriptions.Item label="职务职称">{`${dictionary.jobLabel(princpal.position)} / ${dictionary.jobLabel(princpal.title)}`}</Descriptions.Item>
                                <Descriptions.Item label="政治面貌" span={2}>{dictionary.politicsLabel(princpal.political)}</Descriptions.Item>
                                <Descriptions.Item label="民族">{dictionary.nationLabel(princpal.nation)}</Descriptions.Item>
                            </Descriptions>
                        </Col>
                        <Col span={6} offset={1} className="descriptions-carousel">
                            <Paragraph>
                                <Title level={4}>&nbsp;</Title>
                                <Text>身份证：</Text>
                            </Paragraph>
                            <Carousel>
                            {
                                princpal.idcardImg.split(",").map((src)=>(
                                    <img 
                                        data-image-index={princpalImageIndex++} 
                                        onClick={event=>{this.onPreviewImages(event,"#apply-detail-princpal")}}
                                        src={src} className="image-to-view"
                                        alt={`负责人姓名：${legal.name}；身份证号码：${legal.idcard}`}
                                    />
                                ))
                            }
                            </Carousel>
                        </Col>
                        <Col span={6} className="descriptions-carousel">
                            <Paragraph>
                                <Title level={4}>&nbsp;</Title>
                                <Text>寸照：</Text>
                            </Paragraph>
                            <Carousel>
                            {
                                princpal.img.split(",").map((src)=>(
                                    <img 
                                        data-image-index={princpalImageIndex++} 
                                        onClick={event=>{this.onPreviewImages(event,"#apply-detail-princpal")}}
                                        src={src} className="image-to-view"
                                        alt={`负责人姓名：${princpal.name}`}
                                    />
                                ))
                            }
                            </Carousel>
                        </Col>
                    </Row>
                    <Row style={{marginTop:20}}>
                    <Col span={11}>
                            <Descriptions layout="vertical" bordered={true} size="small">
                                <Descriptions.Item label="工作履历">
                                {
                                    princpal.personalResumes.map(resume=>(
                                        <span>{`${resume.time}：工作于【${resume.unit}】，职务为${resume.position}。`}<br/></span>
                                    ))
                                }
                                </Descriptions.Item>
                            </Descriptions>
                        </Col>
                        <Col span={6} offset={1} className="descriptions-carousel">
                            <Paragraph>
                                <Text>执业证书：</Text>
                            </Paragraph>
                            <Carousel>
                            {
                                princpal.practiceImg.split(",").map((src)=>(
                                    <img 
                                        data-image-index={princpalImageIndex++} 
                                        onClick={event=>{this.onPreviewImages(event,"#apply-detail-princpal")}}
                                        src={src} className="image-to-view"
                                        alt={`负责人姓名：${princpal.name}；执业证号：${princpal.practiceCode}`}
                                    />
                                ))
                            }
                            </Carousel>
                        </Col>
                        <Col span={6} className="descriptions-carousel">
                            <Paragraph>
                                <Text>签字表：</Text>
                            </Paragraph>
                            <Carousel>
                            {
                                princpal.signature.split(",").map((src)=>(
                                    <img 
                                        data-image-index={princpalImageIndex++} 
                                        onClick={event=>{this.onPreviewImages(event,"#apply-detail-princpal")}}
                                        src={src} className="image-to-view"
                                        alt={`负责人姓名：${princpal.name}`}
                                    />
                                ))
                            }
                            </Carousel>
                        </Col>
                    </Row>
                </div>
                
                {/* 联系人 */}
                <Row style={{marginTop:35}}>
                    <Col span={24}>
                        <Descriptions title={
                                <Title level={4}>
                                    <Text strong>{contact.name}</Text>
                                    <Tag color="geekblue" style={{marginLeft:5}}>联系人</Tag>
                                </Title>
                            }
                            layout="vertical"
                            column={4} bordered={true} size="small">
                            <Descriptions.Item label="手机号码">{contact.phone}</Descriptions.Item>
                            <Descriptions.Item label="传真号码" span={3}>{contact.jobPhone}</Descriptions.Item>
                            <Descriptions.Item label="微信号">{contact.wechat||"暂无"}</Descriptions.Item>
                            <Descriptions.Item label="QQ号码" span={2}>{contact.qq||"暂无"}</Descriptions.Item>
                            <Descriptions.Item label="电子邮箱">{contact.email||"暂无"}</Descriptions.Item>
                        </Descriptions>
                    </Col>
                </Row>
            </Content>
        );
    }

    /**
     * 预览相关图片
     */
    onPreviewImages=(event:React.MouseEvent<HTMLImageElement>,id:string)=>{
        const target=event.target as HTMLImageElement;
        const container=document.querySelector(id);
        if(container){
            const imgs=container.querySelectorAll<HTMLImageElement>
                (".slick-slide:not(.slick-cloned) img.image-to-view");
            const imageList:Array<HTMLImageElement>=[];
            imgs.forEach(img=>{
                imageList.push(img)
            });
            const selectedIndex=Number(
                target.dataset["imageIndex"]||"0"
            );
            ImageViewer.view(imageList,selectedIndex);
        }
    }
}