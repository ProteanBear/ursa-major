{"ast":null,"code":"/**\n * Token记录的模式\n */\nexport let CacheMode;\n/**\n * 数据缓存器：单例模式\n */\n\n(function (CacheMode) {\n  CacheMode[CacheMode[\"LOCAL\"] = 0] = \"LOCAL\";\n  CacheMode[CacheMode[\"SESSION\"] = 1] = \"SESSION\";\n})(CacheMode || (CacheMode = {}));\n\nexport class DataCache {\n  constructor() {\n    this._tokenExpired = 2 * 24 * 60;\n    this._dictionaryExpired = 60 * 24 * 60;\n    this._dataMap = new Map();\n  }\n\n  DataCache() {} // Token默认缓存时间(单位：分钟)\n\n\n  /**\n   * 写入或返回本地储存的Token\n   * @param t token内容\n   */\n  token(t, data, type) {\n    if (t && data) {\n      type = type || CacheMode.LOCAL;\n\n      if (type === CacheMode.LOCAL) {\n        this.put(\"token\", t, this._tokenExpired);\n        this.put(\"token_data\", JSON.stringify(data), this._tokenExpired);\n      }\n\n      if (type === CacheMode.SESSION) {\n        this.putIntoSession(\"token\", t);\n        this.putIntoSession(\"token_data\", JSON.stringify(data));\n      }\n\n      return {\n        token: t,\n        data: data\n      };\n    }\n\n    let dataJson = this.get(\"token_data\");\n    dataJson = dataJson || this.getFromSession(\"token_data\");\n    let token = this.get(\"token\");\n    token = token || this.getFromSession(\"token\");\n    return {\n      token: token,\n      data: dataJson ? JSON.parse(dataJson) : null\n    };\n  }\n  /**\n   * 清除全部Token相关的记录\n   * @param t \n   */\n\n\n  tokenClear() {\n    this.remove(\"token\");\n    this.remove(\"token_expired\");\n    this.remove(\"token_data\");\n    this.remove(\"token_data_expired\");\n  }\n  /**\n   * 用于不同路由之间的数据传递（仅记录在内存中）\n   * @param data 数据内容\n   */\n\n\n  transfer(data) {\n    if (data) {\n      this._dataMap.set(\"transferData\", data);\n    }\n\n    return this._dataMap.get(\"transferData\");\n  }\n  /**\n   * 获取或插入数据字典信息\n   * @param keyOrData 子项键名或插入数据对象\n   */\n\n\n  dictionary(keyOrData) {\n    //写入模式\n    if (keyOrData && !(typeof keyOrData === \"string\")) {\n      this.put(\"dictionary\", JSON.stringify(keyOrData), this._dictionaryExpired);\n      return keyOrData;\n    }\n\n    const value = this.get(\"dictionary\");\n    const data = value ? JSON.parse(value) : null; //全部返回模式\n\n    if (!data) return data; //子项返回模式\n\n    return data[keyOrData];\n  }\n  /**\n   * 本地存储写入\n   * @param key \n   * @param value \n   * @param expired 过期时间（单位为分钟）\n   */\n\n\n  put(key, value, expired) {\n    if (!window.localStorage) return;\n    localStorage.setItem(key, value);\n\n    if (expired) {\n      localStorage.setItem(key + \"_expired\", String(Date.now() + expired * 60 * 1000));\n    }\n  }\n  /**\n   * 写入Session中\n   * @param key\n   * @param value \n   */\n\n\n  putIntoSession(key, value) {\n    if (!window.sessionStorage) return;\n    sessionStorage.setItem(key, value);\n  }\n  /**\n   * 本地存储值获取\n   * @param key \n   */\n\n\n  get(key) {\n    if (!window.localStorage) return null; // 检查过期后删除\n\n    const now = Date.now();\n    const expired = localStorage.getItem(key + \"_expired\") || now + 1;\n\n    if (now >= expired) {\n      localStorage.removeItem(key);\n      return null;\n    }\n\n    return localStorage.getItem(key);\n  }\n  /**\n   * 本地存储值删除\n   * @param key \n   */\n\n\n  remove(key) {\n    if (!window.localStorage) return;\n    localStorage.removeItem(key);\n  }\n  /**\n   * 会话存储值获取\n   * @param key \n   */\n\n\n  getFromSession(key) {\n    if (!window.sessionStorage) return null;\n    return sessionStorage.getItem(key);\n  }\n\n}\nDataCache.instance = new DataCache();","map":{"version":3,"sources":["/Users/maqiang/编程/yzwj-recorder-web/src/app/DataCache.ts"],"names":["CacheMode","DataCache","_tokenExpired","_dictionaryExpired","_dataMap","Map","token","t","data","type","LOCAL","put","JSON","stringify","SESSION","putIntoSession","dataJson","get","getFromSession","parse","tokenClear","remove","transfer","set","dictionary","keyOrData","value","key","expired","window","localStorage","setItem","String","Date","now","sessionStorage","getItem","removeItem","instance"],"mappings":"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","sourcesContent":["import { LoginStatus } from \"./Model\";\n\n/**\n * Token记录的模式\n */\nexport enum CacheMode{\n    LOCAL,SESSION\n}\n\n/**\n * 数据缓存器：单例模式\n */\nexport class DataCache{\n    public static readonly instance:DataCache=new DataCache();\n    private DataCache(){}\n\n    // Token默认缓存时间(单位：分钟)\n    private _tokenExpired:number=2*24*60;\n    // 字典数据默认缓存时间(单位：分钟)\n    private _dictionaryExpired:number=60*24*60;\n\n    //记录传递的数据信息\n    private _dataMap:Map<string,any>=new Map();\n\n    /**\n     * 写入或返回本地储存的Token\n     * @param t token内容\n     */\n    token(t?:string,data?:LoginStatus,type?:CacheMode)\n        :{token:string|null,data?:LoginStatus}{\n        if(t&&data){\n            type=(type||CacheMode.LOCAL);\n            if(type===CacheMode.LOCAL){\n                this.put(\"token\",t,this._tokenExpired);\n                this.put(\"token_data\",JSON.stringify(data),this._tokenExpired);\n            }\n            if(type===CacheMode.SESSION){\n                this.putIntoSession(\"token\",t);\n                this.putIntoSession(\"token_data\",JSON.stringify(data));\n            }\n            return {token:t,data:data};\n        }\n        let dataJson=this.get(\"token_data\");\n        dataJson=dataJson||this.getFromSession(\"token_data\");\n        let token=this.get(\"token\");\n        token=token||this.getFromSession(\"token\");\n        return {token:token,data:dataJson?JSON.parse(dataJson):null};\n    }\n\n    /**\n     * 清除全部Token相关的记录\n     * @param t \n     */\n    tokenClear(){\n        this.remove(\"token\");\n        this.remove(\"token_expired\")\n        this.remove(\"token_data\");\n        this.remove(\"token_data_expired\");\n    }\n\n    /**\n     * 用于不同路由之间的数据传递（仅记录在内存中）\n     * @param data 数据内容\n     */\n    transfer(data?:any){\n        if(data){\n            this._dataMap.set(\"transferData\",data);\n        }\n        return this._dataMap.get(\"transferData\");\n    }\n\n    /**\n     * 获取或插入数据字典信息\n     * @param keyOrData 子项键名或插入数据对象\n     */\n    dictionary(keyOrData?:string|any){\n        //写入模式\n        if(keyOrData&&!(typeof keyOrData===\"string\")){\n            this.put(\"dictionary\",JSON.stringify(keyOrData),this._dictionaryExpired);\n            return keyOrData;\n        }\n\n        const value=this.get(\"dictionary\");\n        const data=value?JSON.parse(value):null;\n\n        //全部返回模式\n        if(!data) return data;\n        //子项返回模式\n        return data[keyOrData];\n    }\n\n    /**\n     * 本地存储写入\n     * @param key \n     * @param value \n     * @param expired 过期时间（单位为分钟）\n     */\n    private put(key:string,value:string,expired:number):void{\n        if(!window.localStorage) return;\n\n        localStorage.setItem(key,value);\n        if(expired){\n            localStorage.setItem(key+\"_expired\",String(Date.now()+expired*60*1000));\n        }\n    }\n\n    /**\n     * 写入Session中\n     * @param key\n     * @param value \n     */\n    private putIntoSession(key:string,value:string):void{\n        if(!window.sessionStorage) return;\n        sessionStorage.setItem(key,value);\n    }\n\n    /**\n     * 本地存储值获取\n     * @param key \n     */\n    private get(key:string){\n        if(!window.localStorage) return null;\n\n        // 检查过期后删除\n        const now=Date.now();\n        const expired=localStorage.getItem(key+\"_expired\")||now+1;\n        if(now>=expired){\n            localStorage.removeItem(key);\n            return null;\n        }\n        \n        return localStorage.getItem(key);\n    }\n\n    /**\n     * 本地存储值删除\n     * @param key \n     */\n    private remove(key:string){\n        if(!window.localStorage) return;\n        localStorage.removeItem(key);\n    }\n\n    /**\n     * 会话存储值获取\n     * @param key \n     */\n    private getFromSession(key:string){\n        if(!window.sessionStorage) return null;   \n        return sessionStorage.getItem(key);\n    }\n}"]},"metadata":{},"sourceType":"module"}