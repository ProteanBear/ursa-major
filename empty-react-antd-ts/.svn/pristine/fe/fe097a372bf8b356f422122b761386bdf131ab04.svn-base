import React from 'react';
import { ApplyContentOrganization, ApplyContentEquipment } from '../app/Model';
import { Skeleton, Layout, Row, Col, Typography, Carousel, Descriptions,Button } from 'antd';
import ImageViewer from './ImageViewer';
import { DictionaryLoader } from '../app/DictionaryLoader';

type ApplyDetailInforOrganizationProps={
    data?:ApplyContentOrganization,
    equipments?:Array<ApplyContentEquipment>
}

/**
 * 申请详情中的申请资料中的机构信息
 */
export default class ApplyDetailInforOrganization extends React.Component<ApplyDetailInforOrganizationProps>{
    readonly state:{}={}

    /**
     * 页面布局
     */
    render(){
        if(!this.props.data||!this.props.equipments){
            return (
                <Skeleton active /> 
            );
        }

        const {Content}=Layout;
        const {Paragraph,Title,Text}=Typography;
        const {data,equipments}=this.props;
        const dictionary=DictionaryLoader.instance;
        let index=0;

        return (
            <Content id="apply-detail-organization">
                <Row>
                    <Col span={6} className="descriptions-carousel">
                        <Paragraph>
                            <Text>营业执照：</Text>
                        </Paragraph>
                        <Carousel>
                            {
                                data.businessLicense.split(",").map((src)=>(
                                    <img data-image-index={index++} onClick={this.onPreviewImages}
                                        src={src} className="image-to-view"
                                        alt={`机构名称：${data.name}；社会统一信用代码：${data.onlyCode||"无"}`}
                                    />
                                ))
                            }
                        </Carousel>
                    </Col>
                    <Col span={18}>
                        <Descriptions layout="vertical"
                            column={4} bordered={true} size="small">
                            <Descriptions.Item label="所属街道">{dictionary.streetLabel(data.street)}</Descriptions.Item>
                            <Descriptions.Item label="社会统一信用代码" span={3}>{data.onlyCode||"暂无"}</Descriptions.Item>
                            <Descriptions.Item label="所有制性质">{dictionary.ownershipLabel(data.ownership)}</Descriptions.Item>
                            <Descriptions.Item label="隶属关系" span={2}>{dictionary.subjectionLabel(data.membership)}</Descriptions.Item>
                            <Descriptions.Item label="经营性质">{data.natureOperation}</Descriptions.Item>
                            <Descriptions.Item label="机构地址" span={4}>{data.address}</Descriptions.Item>
                        </Descriptions>
                    </Col>
                </Row>
                <Row>
                    <Col span={17}>
                        <Descriptions title="　" layout="vertical"
                            column={4} bordered={true} size="small">
                            <Descriptions.Item label="诊疗科目" span={4}>{data.diagnosisSubjectName}</Descriptions.Item>
                            <Descriptions.Item label="设备清单" span={4}>
                                {
                                    equipments.map(equip=>(
                                        <span>{`${equip.name}（${equip.type===0?"大型设备":"普通设备"}，${equip.num}台）`}<br/></span>
                                    ))
                                }
                            </Descriptions.Item>
                            <Descriptions.Item label="中医诊疗技术和方案" span={4}>{data.medicineTechnology||"暂无"}</Descriptions.Item>
                            <Descriptions.Item label="中医（专长）医师执业范围" span={4}>{data.medicineScope||"暂无"}</Descriptions.Item>
                            <Descriptions.Item label="医疗废物服务协议" span={2}>
                                <Button type="link" icon="download"
                                    onClick={()=>{this.onDownload(data.medicalWasteAgreement)}}
                                >下载</Button>
                            </Descriptions.Item>
                            <Descriptions.Item label="机构制度" span={2}>
                                <Button type="link" icon="download"
                                    onClick={()=>{this.onDownload(data.managerment)}}
                                >下载</Button>
                            </Descriptions.Item>
                        </Descriptions>
                    </Col>
                    <Col span={6} offset={1} className="descriptions-carousel">
                        <Paragraph>
                            <Title level={4}>&nbsp;</Title>
                            <Text>房屋平面布局图：</Text>
                        </Paragraph>
                        <Carousel>
                            {
                                data.orgFlatImg.split(",").map((src)=>(
                                    <img data-image-index={index++} onClick={this.onPreviewImages}
                                        src={src} className="image-to-view"
                                        alt={`机构名称：${data.name}`}
                                    />
                                ))
                            }
                        </Carousel>
                        <Paragraph>
                            <Text>告知承诺书：</Text>
                        </Paragraph>
                        <Carousel>
                            {
                                data.commitment.split(",").map((src)=>(
                                    <img data-image-index={index++} onClick={this.onPreviewImages}
                                        src={src} className="image-to-view"
                                        alt={`机构名称：${data.name}`}
                                    />
                                ))
                            }
                        </Carousel>
                    </Col>
                </Row>
            </Content>
        );
    }

    /**
     * 预览相关图片
     */
    onPreviewImages=(event:React.MouseEvent<HTMLImageElement>)=>{
        const target=event.target as HTMLImageElement;
        const container=document.querySelector("#apply-detail-organization");
        if(container){
            const imgs=container.querySelectorAll<HTMLImageElement>
                (".slick-slide:not(.slick-cloned) img.image-to-view");
            const imageList:Array<HTMLImageElement>=[];
            imgs.forEach(img=>{
                imageList.push(img)
            });
            const selectedIndex=Number(
                target.dataset["imageIndex"]||"0"
            );
            ImageViewer.view(imageList,selectedIndex);
        }
    }

    /**
     * 下载指定的文件
     */
    onDownload=(url:string)=>{
        window.open(url);
    }
}